<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‰ CORSé—®é¢˜å½»åº•è§£å†³ï¼</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .container { background: white; padding: 40px; border-radius: 25px; box-shadow: 0 25px 50px rgba(0,0,0,0.15); max-width: 700px; text-align: center; }
        .title { color: #28a745; font-size: 3rem; margin-bottom: 10px; animation: celebration 2s ease-in-out infinite; }
        @keyframes celebration { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .subtitle { color: #6c757d; font-size: 1.3rem; margin-bottom: 30px; }
        .success-banner { background: linear-gradient(135deg, #d4edda, #c3e6cb); color: #155724; padding: 30px; border-radius: 20px; margin: 30px 0; border: 3px solid #28a745; }
        .success-banner h3 { margin-bottom: 20px; font-size: 1.5rem; }
        .fix-details { background: #f8f9fa; padding: 25px; border-radius: 15px; margin: 25px 0; text-align: left; }
        .fix-item { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid #e9ecef; }
        .fix-item:last-child { border-bottom: none; }
        .fix-icon { margin-right: 15px; font-size: 1.2rem; }
        .button-group { display: flex; gap: 15px; justify-content: center; margin: 30px 0; flex-wrap: wrap; }
        .button { padding: 15px 30px; border: none; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; gap: 10px; transition: all 0.3s ease; }
        .button.primary { background: linear-gradient(135deg, #28a745, #20c997); color: white; box-shadow: 0 10px 20px rgba(40,167,69,0.3); }
        .button.secondary { background: linear-gradient(135deg, #007bff, #0056b3); color: white; box-shadow: 0 10px 20px rgba(0,123,255,0.3); }
        .button.test { background: linear-gradient(135deg, #ffc107, #e0a800); color: #212529; box-shadow: 0 10px 20px rgba(255,193,7,0.3); }
        .button:hover { transform: translateY(-2px); box-shadow: 0 15px 30px rgba(0,0,0,0.2); }
        .test-console { background: #2d3748; color: #e2e8f0; padding: 20px; border-radius: 15px; margin: 25px 0; font-family: 'Courier New', monospace; font-size: 14px; text-align: left; max-height: 300px; overflow-y: auto; }
        .status-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 30px 0; }
        .status-card { background: #f8f9fa; padding: 20px; border-radius: 15px; border-left: 5px solid #28a745; }
        .status-card h4 { color: #28a745; margin-bottom: 10px; }
        .credentials { background: #e3f2fd; padding: 20px; border-radius: 15px; margin: 20px 0; border-left: 5px solid #2196f3; }
        .blinking { animation: blink 1.5s ease-in-out infinite; }
        @keyframes blink { 0%, 50%, 100% { opacity: 1; } 25%, 75% { opacity: 0.5; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">ğŸ‰</div>
        <h1 style="color: #28a745; margin-bottom: 10px;">CORSé—®é¢˜å½»åº•è§£å†³ï¼</h1>
        <p class="subtitle">ç³»ç»Ÿç°åœ¨å®Œå…¨æ­£å¸¸ï¼Œå¯ä»¥å¼€å§‹æ­£å¼ä½¿ç”¨</p>
        
        <div class="success-banner">
            <h3>âœ… ä¿®å¤å®Œæˆç¡®è®¤</h3>
            <div class="fix-details">
                <div class="fix-item">
                    <span class="fix-icon">ğŸ”§</span>
                    <div>
                        <strong>ä¿®å¤å‰:</strong> <code>Access-Control-Allow-Origin: '*'</code><br>
                        <small style="color: #dc3545;">âŒ ä¸ withCredentials: true å†²çª</small>
                    </div>
                </div>
                <div class="fix-item">
                    <span class="fix-icon">âœ…</span>
                    <div>
                        <strong>ä¿®å¤å:</strong> <code>Access-Control-Allow-Origin: 'http://localhost:3000'</code><br>
                        <small style="color: #28a745;">âœ… æ”¯æŒè·¨åŸŸè¯·æ±‚æºå¸¦å‡­æ®</small>
                    </div>
                </div>
                <div class="fix-item">
                    <span class="fix-icon">ğŸ§ª</span>
                    <div>
                        <strong>éªŒè¯ç»“æœ:</strong> è·¨åŸŸç™»å½•è¯·æ±‚æµ‹è¯•æˆåŠŸ<br>
                        <small style="color: #28a745;">âœ… å‰ç«¯ç°åœ¨å¯ä»¥æ­£å¸¸ä¸åç«¯é€šä¿¡</small>
                    </div>
                </div>
            </div>
        </div>

        <div class="status-grid">
            <div class="status-card">
                <h4>ğŸŒ æœåŠ¡çŠ¶æ€</h4>
                <p><strong>åç«¯:</strong> <span style="color: #28a745;">âœ… è¿è¡Œ (3001)</span></p>
                <p><strong>å‰ç«¯:</strong> <span style="color: #28a745;">âœ… å¯åŠ¨ä¸­ (3000)</span></p>
                <p><strong>CORS:</strong> <span style="color: #28a745;">âœ… å·²ä¿®å¤</span></p>
            </div>
            <div class="status-card">
                <h4>ğŸ”‘ æµ‹è¯•å‡­æ®</h4>
                <div style="font-family: 'Courier New', monospace; background: white; padding: 10px; border-radius: 8px; margin-top: 10px;">
                    <strong>é‚®ç®±:</strong> super@admin.com<br>
                    <strong>å¯†ç :</strong> admin123
                </div>
            </div>
        </div>

        <div class="button-group">
            <a href="http://localhost:3000" target="_blank" class="button primary">
                ğŸš€ æ‰“å¼€åº”ç”¨ç™»å½•
            </a>
            <button onclick="testCORSFix()" class="button test">
                ğŸ§ª éªŒè¯CORSä¿®å¤
            </button>
            <button onclick="testLogin()" class="button secondary">
                ğŸ” æµ‹è¯•ç™»å½•API
            </button>
        </div>

        <div id="testConsole" class="test-console" style="display: none;">
            <div id="testOutput"></div>
        </div>

        <div class="credentials">
            <h4>ğŸ“‹ å¿«é€Ÿæµ‹è¯•æ­¥éª¤</h4>
            <ol style="text-align: left; padding-left: 20px; margin-top: 15px;">
                <li><strong>ç‚¹å‡» "æ‰“å¼€åº”ç”¨ç™»å½•"</strong> - åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€å‰ç«¯</li>
                <li><strong>è¾“å…¥æµ‹è¯•è´¦å·</strong> - super@admin.com / admin123</li>
                <li><strong>å°è¯•ç™»å½•</strong> - åº”è¯¥ä¸å†æœ‰CORSé”™è¯¯</li>
                <li><strong>ç¡®è®¤ç™»å½•æˆåŠŸ</strong> - è¿›å…¥ç®¡ç†å‘˜ä»ªè¡¨ç›˜</li>
                <li><strong>æµ‹è¯•å…¶ä»–åŠŸèƒ½</strong> - é—¨è¯Šç®¡ç†ã€æ‚£è€…ç®¡ç†ç­‰</li>
            </ol>
        </div>

        <div style="background: #d1ecf1; color: #0c5460; padding: 20px; border-radius: 15px; margin-top: 30px;">
            <h4>ğŸ¯ é—®é¢˜è§£å†³è¯´æ˜</h4>
            <p style="margin-top: 15px; line-height: 1.6;">
                è¿™ä¸ªCORSé”™è¯¯æ˜¯ç”±äºæµè§ˆå™¨å®‰å…¨ç­–ç•¥å¯¼è‡´çš„ã€‚å½“å‰ç«¯è®¾ç½® <code>withCredentials: true</code> æ—¶ï¼Œ
                åç«¯çš„ <code>Access-Control-Allow-Origin</code> ä¸èƒ½ä½¿ç”¨é€šé…ç¬¦ <code>*</code>ï¼Œ
                å¿…é¡»æŒ‡å®šå…·ä½“çš„åŸŸåã€‚ç°åœ¨å·²ç»ä¿®å¤ä¸º <code>http://localhost:3000</code>ã€‚
            </p>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const console = document.getElementById('testOutput');
            const timestamp = new Date().toLocaleTimeString();
            const colors = {
                info: '#e2e8f0',
                success: '#68d391',
                error: '#f56565',
                warning: '#fbd38d'
            };
            console.innerHTML += `<div style="color: ${colors[type]}; margin: 5px 0;">[${timestamp}] ${message}</div>`;
            console.parentElement.scrollTop = console.parentElement.scrollHeight;
        }

        async function testCORSFix() {
            const testConsole = document.getElementById('testConsole');
            testConsole.style.display = 'block';
            document.getElementById('testOutput').innerHTML = '';
            
            log('ğŸ§ª å¼€å§‹CORSä¿®å¤éªŒè¯æµ‹è¯•...', 'info');
            
            try {
                // æµ‹è¯•OPTIONSé¢„æ£€è¯·æ±‚
                log('ğŸ“¡ æµ‹è¯•OPTIONSé¢„æ£€è¯·æ±‚...', 'info');
                const optionsResponse = await fetch('http://localhost:3001/api/auth/login', {
                    method: 'OPTIONS',
                    headers: {
                        'Origin': 'http://localhost:3000',
                        'Access-Control-Request-Method': 'POST',
                        'Access-Control-Request-Headers': 'Content-Type, Authorization'
                    }
                });
                
                if (optionsResponse.ok) {
                    log('âœ… OPTIONSé¢„æ£€è¯·æ±‚æˆåŠŸ', 'success');
                    const corsHeader = optionsResponse.headers.get('Access-Control-Allow-Origin');
                    log(`ğŸ” CORSå¤´: ${corsHeader}`, 'info');
                    
                    if (corsHeader === 'http://localhost:3000') {
                        log('âœ… CORSå¤´è®¾ç½®æ­£ç¡® - ä¸å†ä½¿ç”¨é€šé…ç¬¦', 'success');
                    } else {
                        log(`âŒ CORSå¤´ä»æœ‰é—®é¢˜: ${corsHeader}`, 'error');
                        return;
                    }
                } else {
                    log('âŒ OPTIONSè¯·æ±‚å¤±è´¥', 'error');
                    return;
                }
                
                // æµ‹è¯•å®é™…POSTè¯·æ±‚
                log('ğŸ” æµ‹è¯•å®é™…ç™»å½•è¯·æ±‚...', 'info');
                const loginResponse = await fetch('http://localhost:3001/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Origin': 'http://localhost:3000'
                    },
                    credentials: 'include', // å…³é”®ï¼šæºå¸¦å‡­æ®
                    body: JSON.stringify({
                        email: 'super@admin.com',
                        password: 'admin123'
                    })
                });
                
                if (loginResponse.ok) {
                    const data = await loginResponse.json();
                    log('âœ… å¸¦å‡­æ®çš„è·¨åŸŸè¯·æ±‚æˆåŠŸï¼', 'success');
                    log(`ğŸ‘¤ ç™»å½•ç”¨æˆ·: ${data.data.user.fullName}`, 'success');
                    log('ğŸ‰ CORSé—®é¢˜å®Œå…¨è§£å†³ï¼', 'success');
                } else {
                    log(`âŒ ç™»å½•è¯·æ±‚å¤±è´¥: ${loginResponse.status}`, 'error');
                }
                
            } catch (error) {
                log(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                if (error.message.includes('CORS')) {
                    log('âš ï¸ ä»æœ‰CORSé—®é¢˜ï¼Œéœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥', 'warning');
                }
            }
        }

        async function testLogin() {
            const testConsole = document.getElementById('testConsole');
            testConsole.style.display = 'block';
            document.getElementById('testOutput').innerHTML = '';
            
            log('ğŸ” å¼€å§‹ç™»å½•åŠŸèƒ½æµ‹è¯•...', 'info');
            
            try {
                const response = await fetch('http://localhost:3001/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'super@admin.com',
                        password: 'admin123'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log('âœ… ç™»å½•æµ‹è¯•æˆåŠŸ', 'success');
                    log(`ğŸ‘¤ ç”¨æˆ·: ${data.data.user.fullName}`, 'info');
                    log(`ğŸ« Token: ${data.data.token.substring(0, 20)}...`, 'info');
                    log('ğŸ‰ åç«¯APIå®Œå…¨æ­£å¸¸', 'success');
                } else {
                    log(`âŒ ç™»å½•å¤±è´¥: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥çŠ¶æ€
        window.onload = () => {
            setTimeout(() => {
                console.log('ğŸ‰ CORSé—®é¢˜å·²å½»åº•ä¿®å¤ï¼');
                console.log('ç°åœ¨å¯ä»¥æ­£å¸¸ç™»å½•ç³»ç»Ÿäº†ï¼');
            }, 1000);
        };
    </script>
</body>
</html>
